(()=>{"use strict";var e={};function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,l=Array(t);n<t;n++)l[n]=e[n];return l}e.n=t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},e.d=(t,n)=>{for(var l in n)e.o(n,l)&&!e.o(t,l)&&Object.defineProperty(t,l,{enumerable:!0,get:n[l]})},e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const n=window.wp.blockEditor,l=window.wp.components,r=window.wp.compose,o=window.wp.data,a=window.wp.element,i=window.wp.hooks,c=window.wp.i18n,d=window.wp.apiFetch;var s=e.n(d);const u=window.wp.blocks;var g=(0,r.createHigherOrderComponent)(function(e){return function(r){var i,d,g,v,y,m,w,f=(m=(0,a.useState)(!1),w=2,function(e){if(Array.isArray(e))return e}(m)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var l,r,o,a,i=[],c=!0,d=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(l=o.call(n)).done)&&(i.push(l.value),i.length!==t);c=!0);}catch(e){d=!0,r=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(d)throw r}}return i}}(m,w)||function(e,n){if(e){if("string"==typeof e)return t(e,n);var l={}.toString.call(e).slice(8,-1);return"Object"===l&&e.constructor&&(l=e.constructor.name),"Map"===l||"Set"===l?Array.from(e):"Arguments"===l||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?t(e,n):void 0}}(m,w)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),p=f[0],b=f[1];if(!(0,o.useSelect)(function(e){var t,n=e("core/block-editor"),l=n.getBlock(r.clientId),o=n.getBlockRootClientId(r.clientId);return"core/gallery"===(null==l?void 0:l.name)||o&&"core/gallery"===(null===(t=n.getBlock(o))||void 0===t?void 0:t.name)},[r.clientId]))return React.createElement(e,r);var k=(null===(i=window.imagelyConvertData)||void 0===i?void 0:i.panelTitle)||(0,c.__)("Imagely Gallery","nggallery"),h=(null===(d=window.imagelyConvertData)||void 0===d?void 0:d.contentHeading)||(0,c.__)("Convert to Imagely","nggallery"),_=(null===(g=window.imagelyConvertData)||void 0===g?void 0:g.contentDescription)||(0,c.__)("Convert this WordPress Gallery to an Imagely Gallery for more features and customization options.","nggallery"),C=(null===(v=window.imagelyConvertData)||void 0===v?void 0:v.contentButtonText)||(0,c.__)("Convert to Imagely Gallery","nggallery"),E=(null===(y=window.imagelyConvertData)||void 0===y?void 0:y.convertLoading)||(0,c.__)("Converting...","nggallery");return React.createElement(React.Fragment,null,React.createElement(e,r),React.createElement(n.InspectorControls,null,React.createElement(l.PanelBody,{title:k,initialOpen:!0},React.createElement(l.PanelRow,null,React.createElement("strong",null,h)),React.createElement(l.PanelRow,null,React.createElement("p",null,_)),React.createElement(l.PanelRow,null,React.createElement(l.Button,{variant:"primary",onClick:function(){return function(e,t){var n,l,r,o,a=window.wp.data,i=a.select,d=a.dispatch,g=function(e){for(var t=i("core/block-editor"),n=e,l=t.getBlock(n);l;){if("core/gallery"===l.name)return l;var r=t.getBlockRootClientId(n);if(!r)break;n=r,l=t.getBlock(n)}return null}(e);if(g){if(window.confirm((null===(n=window.imagelyConvertData)||void 0===n?void 0:n.confirmationMessage)||(0,c.__)("Are you sure you want to convert this WordPress Gallery to an Imagely Gallery? This action cannot be undone.","nggallery"))){t(!0);var v,y=(0,u.serialize)([g]),m=g.attributes,w={post_id:(null===(l=window.imagelyConvertData)||void 0===l?void 0:l.postId)||0,columns:m.columns||3,sizeSlug:m.sizeSlug||"thumbnail",linkTarget:m.linkTarget||"",images:[],blockContent:y};if((g.innerBlocks||[]).forEach(function(e){var t=e.attributes;t.id&&w.images.push({id:t.id,url:t.url||"",title:t.title||"",alt:t.alt||""})}),!w.images.length)return d("core/notices").createErrorNotice((null===(v=window.imagelyConvertData)||void 0===v?void 0:v.noImagesMessage)||(0,c.__)("No images found in the gallery. Please add images before converting.","nggallery"),{isDismissible:!0,type:"snackbar"}),void t(!1);s()({path:(null===(r=window.imagelyConvertData)||void 0===r?void 0:r.convertApiUrl)||"/imagely/v1/convert-gallery/single",method:"POST",data:w}).then(function(e){var t=e;if(t&&t.gallery_id){var n=(0,u.createBlock)("imagely/main-block",{content:'[imagely id="'.concat(t.gallery_id,'"]')});d("core/block-editor").replaceBlocks(g.clientId,[n]),d("core/notices").createSuccessNotice(t.message||(0,c.__)("Gallery converted successfully!","nggallery"),{isDismissible:!0,type:"snackbar"})}}).catch(function(e){var t,n=(null==e?void 0:e.message)||(null===(t=window.imagelyConvertData)||void 0===t?void 0:t.errorMessage)||(0,c.__)("An error occurred while converting the gallery.","nggallery");d("core/notices").createErrorNotice(n,{isDismissible:!0,type:"snackbar"})}).finally(function(){t(!1)})}}else d("core/notices").createErrorNotice((null===(o=window.imagelyConvertData)||void 0===o?void 0:o.invalidBlockMessage)||(0,c.__)("Invalid block. Please select a WordPress Gallery block.","nggallery"),{isDismissible:!0,type:"snackbar"})}(r.clientId,b)},disabled:p},p?React.createElement(React.Fragment,null,React.createElement("span",null,E),React.createElement(l.Spinner,null)):C)))))}},"addConvertButtonToGalleryBlock");(0,i.addFilter)("editor.BlockEdit","imagely/gallery-conversion",g)})();